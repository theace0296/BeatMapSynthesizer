"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// All of the Node.js APIs are available in the preload process.
// It has the same sandbox as a Chrome extension.
const electron_1 = require("electron");
const __beatMapArgs_1 = __importDefault(require("./__beatMapArgs"));
let args = new __beatMapArgs_1.default();
let selectedDirs = [];
class operationType {
    static directory = 0;
    static files = 1;
}
var currentOperationType = operationType.files;
function parseFileList() {
    selectedDirs.length = 0;
    const fileListElement = document.getElementById('filelist');
    let matches = fileListElement.value.match(/^(\b|")(.+)(\b|")$/gm);
    if (matches) {
        for (let match of matches) {
            // Remove any quotation marks
            let normalizedMatch = match.replace(/"/g, '');
            // Append filename to varaible
            selectedDirs.push(normalizedMatch);
            // Create the list item:
            let item = document.createElement('li');
            // Set its contents:
            item.appendChild(document.createTextNode(normalizedMatch));
            // Add it to the list:
            document.getElementById('dirsfilesList')?.appendChild(item);
        }
    }
}
function resetTaskLog() {
    if (document.getElementById('taskLogDiv')?.innerHTML !== '') {
        document.getElementById('taskLogDiv').innerHTML = '';
    }
    let element = document.createElement('pre');
    element.classList.add('prettyprint');
    element.classList.add('mvl');
    element.id = 'taskLog_MAIN';
    document.getElementById('taskLogDiv')?.appendChild(element);
}
window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('selectFilesButton')?.addEventListener('click', () => {
        if (document.getElementById('dirsfilesList')?.innerHTML !== '') {
            document.getElementById('dirsfilesList').innerHTML = '';
        }
        currentOperationType = operationType.files;
        electron_1.ipcRenderer.send('__selectFiles__');
    });
    document.getElementById('selectDirectoryButton')?.addEventListener('click', () => {
        if (document.getElementById('dirsfilesList')?.innerHTML !== '') {
            document.getElementById('dirsfilesList').innerHTML = '';
        }
        currentOperationType = operationType.directory;
        electron_1.ipcRenderer.send('__selectDirectory__');
    });
    document.getElementById('selectFileListButton')?.addEventListener('click', () => {
        if (document.getElementById('dirsfilesList')?.innerHTML !== '') {
            document.getElementById('dirsfilesList').innerHTML = '';
        }
        currentOperationType = operationType.directory;
        document.getElementById('filelist')?.classList.remove('hidden');
        parseFileList();
    });
    document.getElementById('filelist')?.addEventListener('change', parseFileList);
    document.getElementById('chooseOutputDirButton')?.addEventListener('click', () => {
        if (document.getElementById('outputDirList')?.innerHTML !== '') {
            document.getElementById('outputDirList').innerHTML = '';
        }
        electron_1.ipcRenderer.send('__selectOutDirectory__');
    });
    document.getElementById('difficultylist')?.addEventListener('change', () => {
        args.difficulty = document.getElementById('difficultylist').value.toString();
    });
    document.getElementById('modellist')?.addEventListener('change', () => {
        args.model = document.getElementById('modellist').value.toString();
        if (args.model.includes('HMM'))
            document.getElementById('dataSource')?.classList.remove('hidden');
        else
            document.getElementById('dataSource')?.classList.add('hidden');
    });
    document.getElementById('environmentlist')?.addEventListener('change', () => {
        args.environment = document.getElementById('environmentlist').value.toString();
    });
    document.getElementById('generateBeatMapButton')?.addEventListener('click', () => {
        resetTaskLog();
        args.version = parseInt(document.getElementById('datalist').value, 10);
        args.lightsIntensity = parseInt(document.getElementById('lightsIntensityInput').value, 10);
        args.zipFiles = document.getElementById('zipFilesLabel')?.classList.contains('checked') ? 1 : 0;
        args.debug = document.getElementById('debugInfoLabel')?.classList.contains('checked') ? 1 : 0;
        electron_1.ipcRenderer.send('__generateBeatMap__', currentOperationType, selectedDirs, args);
    });
    document.getElementById('cancelButton')?.addEventListener('click', () => {
        resetTaskLog();
        electron_1.ipcRenderer.send('__cancelOperation__');
    });
    selectedDirs.push('C:\\Users\\chase.CRR-MSI-X99\\Downloads\\Beat Map Synthesizer\\Top 100\\Billie Eilish\\WHEN WE ALL FALL ASLEEP WHERE DO WE GO\\02-bad guy.mp3');
    args.outDir = 'C:\\Users\\chase.CRR-MSI-X99\\Downloads\\Beat Map Synthesizer';
    selectedDirs.forEach((selectedDir) => document.getElementById('dirsfilesList')?.appendChild(document.createElement('li').appendChild(document.createTextNode(selectedDir))));
    document.getElementById('outputDirList')?.appendChild(document.createElement('li').appendChild(document.createTextNode(args.outDir)));
});
electron_1.ipcRenderer.on('console-log', (_event, message) => console.log(message));
electron_1.ipcRenderer.on('console-error', (_event, message) => console.error(message));
electron_1.ipcRenderer.on('task-progress', (_event, value, maxValue) => {
    if (value === 0) {
        document.getElementById('taskProgressBar').innerHTML = `0%`;
        document.getElementById('taskProgressBar').setAttribute('style', `width: 0%;`);
    }
    else if (value === -1) {
        document.getElementById('taskProgressBar').innerHTML = `100%`;
        document.getElementById('taskProgressBar').setAttribute('style', `width: 100%;`);
    }
    else if (value / maxValue <= 0.1) {
        document.getElementById('taskProgressBar').innerHTML = `${((value / maxValue) * 100).toFixed(0)}%`;
        document.getElementById('taskProgressBar').setAttribute('style', `width: 10%;`);
    }
    else {
        document.getElementById('taskProgressBar').innerHTML = `${((value / maxValue) * 100).toFixed(0)}%`;
        document.getElementById('taskProgressBar').setAttribute('style', `width: ${(value / maxValue) * 100}%;`);
    }
});
electron_1.ipcRenderer.on('task-log-append-message', (_event, message, group = 'MAIN') => {
    let id = `taskLog_${group}`;
    if (document.getElementById(id)) {
        let element = document.createElement('pre');
        element.classList.add('prettyprint');
        element.classList.add('mvl');
        element.id = id;
        element.appendChild(document.createTextNode(message + '\n'));
        document.getElementById('taskLogDiv').appendChild(element);
    }
    else {
        document.getElementById(id).appendChild(document.createTextNode(message + '\n'));
    }
});
electron_1.ipcRenderer.on('selectFilesDirs-finished', (_event, param) => {
    selectedDirs.length = 0;
    for (let value of param) {
        // Append filename to varaible
        selectedDirs.push(value);
        // Create the list item and set its contents
        let item = document.createElement('li');
        item.appendChild(document.createTextNode(value));
        // Add it to the list:
        document.getElementById('dirsfilesList')?.appendChild(item);
    }
});
electron_1.ipcRenderer.on('selectOutDirectory-finished', (_event, param) => {
    // Append filename to varaible
    args.outDir = param;
    // Create the list item and set its contents
    let item = document.createElement('li').appendChild(document.createTextNode(param));
    // Add it to the list:
    document.getElementById('outputDirList')?.appendChild(item);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlbG9hZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wcmVsb2FkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0VBQWdFO0FBQ2hFLGlEQUFpRDtBQUNqRCx1Q0FBdUM7QUFDdkMsb0VBQTRDO0FBRTVDLElBQUksSUFBSSxHQUFrQixJQUFJLHVCQUFhLEVBQUUsQ0FBQztBQUU5QyxJQUFJLFlBQVksR0FBYSxFQUFFLENBQUM7QUFFaEMsTUFBTSxhQUFhO0lBQ2pCLE1BQU0sQ0FBQyxTQUFTLEdBQVcsQ0FBQyxDQUFDO0lBQzdCLE1BQU0sQ0FBQyxLQUFLLEdBQVcsQ0FBQyxDQUFDOztBQUczQixJQUFJLG9CQUFvQixHQUFXLGFBQWEsQ0FBQyxLQUFLLENBQUM7QUFFdkQsU0FBUyxhQUFhO0lBQ3BCLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLE1BQU0sZUFBZSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUF3QixDQUFDO0lBQ25GLElBQUksT0FBTyxHQUFHLGVBQWUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFDbEUsSUFBSSxPQUFPLEVBQUU7UUFDWCxLQUFLLElBQUksS0FBSyxJQUFJLE9BQU8sRUFBRTtZQUN6Qiw2QkFBNkI7WUFDN0IsSUFBSSxlQUFlLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFDOUMsOEJBQThCO1lBQzlCLFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDbkMsd0JBQXdCO1lBQ3hCLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEMsb0JBQW9CO1lBQ3BCLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBQzNELHNCQUFzQjtZQUN0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LDRDQUE0QztJQUM1QyxJQUFJLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDcEYsc0JBQXNCO0lBQ3RCLFFBQVEsQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlELENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQWxsIG9mIHRoZSBOb2RlLmpzIEFQSXMgYXJlIGF2YWlsYWJsZSBpbiB0aGUgcHJlbG9hZCBwcm9jZXNzLlxyXG4vLyBJdCBoYXMgdGhlIHNhbWUgc2FuZGJveCBhcyBhIENocm9tZSBleHRlbnNpb24uXHJcbmltcG9ydCB7IGlwY1JlbmRlcmVyIH0gZnJvbSAnZWxlY3Ryb24nO1xyXG5pbXBvcnQgX19iZWF0TWFwQXJncyBmcm9tIFwiLi9fX2JlYXRNYXBBcmdzXCI7XHJcblxyXG5sZXQgYXJnczogX19iZWF0TWFwQXJncyA9IG5ldyBfX2JlYXRNYXBBcmdzKCk7XHJcblxyXG5sZXQgc2VsZWN0ZWREaXJzOiBzdHJpbmdbXSA9IFtdO1xyXG5cclxuY2xhc3Mgb3BlcmF0aW9uVHlwZSB7XHJcbiAgc3RhdGljIGRpcmVjdG9yeTogbnVtYmVyID0gMDtcclxuICBzdGF0aWMgZmlsZXM6IG51bWJlciA9IDE7XHJcbn1cclxuXHJcbnZhciBjdXJyZW50T3BlcmF0aW9uVHlwZTogbnVtYmVyID0gb3BlcmF0aW9uVHlwZS5maWxlcztcclxuXHJcbmZ1bmN0aW9uIHBhcnNlRmlsZUxpc3QoKSB7XHJcbiAgc2VsZWN0ZWREaXJzLmxlbmd0aCA9IDA7XHJcbiAgY29uc3QgZmlsZUxpc3RFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVsaXN0JykgYXMgSFRNTFRleHRBcmVhRWxlbWVudDtcclxuICBsZXQgbWF0Y2hlcyA9IGZpbGVMaXN0RWxlbWVudC52YWx1ZS5tYXRjaCgvXihcXGJ8XCIpKC4rKShcXGJ8XCIpJC9nbSk7XHJcbiAgaWYgKG1hdGNoZXMpIHtcclxuICAgIGZvciAobGV0IG1hdGNoIG9mIG1hdGNoZXMpIHtcclxuICAgICAgLy8gUmVtb3ZlIGFueSBxdW90YXRpb24gbWFya3NcclxuICAgICAgbGV0IG5vcm1hbGl6ZWRNYXRjaCA9IG1hdGNoLnJlcGxhY2UoL1wiL2csICcnKTtcclxuICAgICAgLy8gQXBwZW5kIGZpbGVuYW1lIHRvIHZhcmFpYmxlXHJcbiAgICAgIHNlbGVjdGVkRGlycy5wdXNoKG5vcm1hbGl6ZWRNYXRjaCk7XHJcbiAgICAgIC8vIENyZWF0ZSB0aGUgbGlzdCBpdGVtOlxyXG4gICAgICBsZXQgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgICAgIC8vIFNldCBpdHMgY29udGVudHM6XHJcbiAgICAgIGl0ZW0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobm9ybWFsaXplZE1hdGNoKSk7XHJcbiAgICAgIC8vIEFkZCBpdCB0byB0aGUgbGlzdDpcclxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcnNmaWxlc0xpc3QnKT8uYXBwZW5kQ2hpbGQoaXRlbSk7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiByZXNldFRhc2tMb2coKSB7XHJcbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrTG9nRGl2Jyk/LmlubmVySFRNTCAhPT0gJycpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrTG9nRGl2JykhLmlubmVySFRNTCA9ICcnO1xyXG4gIH1cclxuICBsZXQgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ByZScpO1xyXG4gIGVsZW1lbnQuY2xhc3NMaXN0LmFkZCgncHJldHR5cHJpbnQnKTtcclxuICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ212bCcpO1xyXG4gIGVsZW1lbnQuaWQgPSAndGFza0xvZ19NQUlOJztcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFza0xvZ0RpdicpPy5hcHBlbmRDaGlsZChlbGVtZW50KTtcclxufVxyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdEZpbGVzQnV0dG9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJzZmlsZXNMaXN0Jyk/LmlubmVySFRNTCAhPT0gJycpIHtcclxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcnNmaWxlc0xpc3QnKSEuaW5uZXJIVE1MID0gJyc7XHJcbiAgICB9XHJcbiAgICBjdXJyZW50T3BlcmF0aW9uVHlwZSA9IG9wZXJhdGlvblR5cGUuZmlsZXM7XHJcbiAgICBpcGNSZW5kZXJlci5zZW5kKCdfX3NlbGVjdEZpbGVzX18nKTtcclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdERpcmVjdG9yeUJ1dHRvbicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlyc2ZpbGVzTGlzdCcpPy5pbm5lckhUTUwgIT09ICcnKSB7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJzZmlsZXNMaXN0JykhLmlubmVySFRNTCA9ICcnO1xyXG4gICAgfVxyXG4gICAgY3VycmVudE9wZXJhdGlvblR5cGUgPSBvcGVyYXRpb25UeXBlLmRpcmVjdG9yeTtcclxuICAgIGlwY1JlbmRlcmVyLnNlbmQoJ19fc2VsZWN0RGlyZWN0b3J5X18nKTtcclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbGVjdEZpbGVMaXN0QnV0dG9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJzZmlsZXNMaXN0Jyk/LmlubmVySFRNTCAhPT0gJycpIHtcclxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcnNmaWxlc0xpc3QnKSEuaW5uZXJIVE1MID0gJyc7XHJcbiAgICB9XHJcbiAgICBjdXJyZW50T3BlcmF0aW9uVHlwZSA9IG9wZXJhdGlvblR5cGUuZGlyZWN0b3J5O1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVsaXN0Jyk/LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xyXG4gICAgcGFyc2VGaWxlTGlzdCgpO1xyXG4gIH0pO1xyXG5cclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZWxpc3QnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgcGFyc2VGaWxlTGlzdCk7XHJcblxyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaG9vc2VPdXRwdXREaXJCdXR0b24nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dERpckxpc3QnKT8uaW5uZXJIVE1MICE9PSAnJykge1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0RGlyTGlzdCcpIS5pbm5lckhUTUwgPSAnJztcclxuICAgIH1cclxuICAgIGlwY1JlbmRlcmVyLnNlbmQoJ19fc2VsZWN0T3V0RGlyZWN0b3J5X18nKTtcclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpZmZpY3VsdHlsaXN0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuICAgIGFyZ3MuZGlmZmljdWx0eSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGlmZmljdWx0eWxpc3QnKSBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWUudG9TdHJpbmcoKTtcclxuICB9KTtcclxuXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vZGVsbGlzdCcpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XHJcbiAgICBhcmdzLm1vZGVsID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlbGxpc3QnKSBhcyBIVE1MU2VsZWN0RWxlbWVudCkudmFsdWUudG9TdHJpbmcoKTtcclxuICAgIGlmIChhcmdzLm1vZGVsLmluY2x1ZGVzKCdITU0nKSkgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGFTb3VyY2UnKT8uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XHJcbiAgICBlbHNlIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkYXRhU291cmNlJyk/LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xyXG4gIH0pO1xyXG5cclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW52aXJvbm1lbnRsaXN0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcclxuICAgIGFyZ3MuZW52aXJvbm1lbnQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Vudmlyb25tZW50bGlzdCcpIGFzIEhUTUxTZWxlY3RFbGVtZW50KS52YWx1ZS50b1N0cmluZygpO1xyXG4gIH0pO1xyXG5cclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2VuZXJhdGVCZWF0TWFwQnV0dG9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgcmVzZXRUYXNrTG9nKCk7XHJcbiAgICBhcmdzLnZlcnNpb24gPSBwYXJzZUludCgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RhdGFsaXN0JykgYXMgSFRNTFNlbGVjdEVsZW1lbnQpLnZhbHVlLCAxMCk7XHJcbiAgICBhcmdzLmxpZ2h0c0ludGVuc2l0eSA9IHBhcnNlSW50KChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGlnaHRzSW50ZW5zaXR5SW5wdXQnKSBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSwgMTApO1xyXG4gICAgYXJncy56aXBGaWxlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd6aXBGaWxlc0xhYmVsJyk/LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpID8gMSA6IDA7XHJcbiAgICBhcmdzLmRlYnVnID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlYnVnSW5mb0xhYmVsJyk/LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpID8gMSA6IDA7XHJcbiAgICBpcGNSZW5kZXJlci5zZW5kKCdfX2dlbmVyYXRlQmVhdE1hcF9fJywgY3VycmVudE9wZXJhdGlvblR5cGUsIHNlbGVjdGVkRGlycywgYXJncyk7XHJcbiAgfSk7XHJcblxyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWxCdXR0b24nKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICByZXNldFRhc2tMb2coKTtcclxuICAgIGlwY1JlbmRlcmVyLnNlbmQoJ19fY2FuY2VsT3BlcmF0aW9uX18nKTtcclxuICB9KTtcclxuXHJcbiAgc2VsZWN0ZWREaXJzLnB1c2goJ0M6XFxcXFVzZXJzXFxcXGNoYXNlLkNSUi1NU0ktWDk5XFxcXERvd25sb2Fkc1xcXFxCZWF0IE1hcCBTeW50aGVzaXplclxcXFxUb3AgMTAwXFxcXEJpbGxpZSBFaWxpc2hcXFxcV0hFTiBXRSBBTEwgRkFMTCBBU0xFRVAgV0hFUkUgRE8gV0UgR09cXFxcMDItYmFkIGd1eS5tcDMnKTtcclxuICBhcmdzLm91dERpciA9ICdDOlxcXFxVc2Vyc1xcXFxjaGFzZS5DUlItTVNJLVg5OVxcXFxEb3dubG9hZHNcXFxcQmVhdCBNYXAgU3ludGhlc2l6ZXInO1xyXG4gIHNlbGVjdGVkRGlycy5mb3JFYWNoKChzZWxlY3RlZERpcikgPT4gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RpcnNmaWxlc0xpc3QnKT8uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzZWxlY3RlZERpcikpKSk7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dERpckxpc3QnKT8uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShhcmdzLm91dERpcikpKTtcclxufSk7XHJcblxyXG5pcGNSZW5kZXJlci5vbignY29uc29sZS1sb2cnLCAoX2V2ZW50LCBtZXNzYWdlOiBzdHJpbmcpID0+IGNvbnNvbGUubG9nKG1lc3NhZ2UpKTtcclxuXHJcbmlwY1JlbmRlcmVyLm9uKCdjb25zb2xlLWVycm9yJywgKF9ldmVudCwgbWVzc2FnZTogc3RyaW5nKSA9PiBjb25zb2xlLmVycm9yKG1lc3NhZ2UpKTtcclxuXHJcbmlwY1JlbmRlcmVyLm9uKCd0YXNrLXByb2dyZXNzJywgKF9ldmVudCwgdmFsdWU6IG51bWJlciwgbWF4VmFsdWU6IG51bWJlcikgPT4ge1xyXG4gIGlmICh2YWx1ZSA9PT0gMCkge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tQcm9ncmVzc0JhcicpIS5pbm5lckhUTUwgPSBgMCVgO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tQcm9ncmVzc0JhcicpIS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYHdpZHRoOiAwJTtgKTtcclxuICB9IGVsc2UgaWYgKHZhbHVlID09PSAtMSkge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tQcm9ncmVzc0JhcicpIS5pbm5lckhUTUwgPSBgMTAwJWA7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGFza1Byb2dyZXNzQmFyJykhLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBgd2lkdGg6IDEwMCU7YCk7XHJcbiAgfSBlbHNlIGlmICh2YWx1ZSAvIG1heFZhbHVlIDw9IDAuMSkge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tQcm9ncmVzc0JhcicpIS5pbm5lckhUTUwgPSBgJHsoKHZhbHVlIC8gbWF4VmFsdWUpICogMTAwKS50b0ZpeGVkKDApfSVgO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Rhc2tQcm9ncmVzc0JhcicpIS5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgYHdpZHRoOiAxMCU7YCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrUHJvZ3Jlc3NCYXInKSEuaW5uZXJIVE1MID0gYCR7KCh2YWx1ZSAvIG1heFZhbHVlKSAqIDEwMCkudG9GaXhlZCgwKX0lYDtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrUHJvZ3Jlc3NCYXInKSEuc2V0QXR0cmlidXRlKCdzdHlsZScsIGB3aWR0aDogJHsodmFsdWUgLyBtYXhWYWx1ZSkgKiAxMDB9JTtgKTtcclxuICB9XHJcbn0pO1xyXG5cclxuaXBjUmVuZGVyZXIub24oJ3Rhc2stbG9nLWFwcGVuZC1tZXNzYWdlJywgKF9ldmVudCwgbWVzc2FnZTogc3RyaW5nLCBncm91cDogc3RyaW5nID0gJ01BSU4nKSA9PiB7XHJcbiAgbGV0IGlkID0gYHRhc2tMb2dfJHtncm91cH1gO1xyXG4gIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkpIHtcclxuICAgIGxldCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncHJlJyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3ByZXR0eXByaW50Jyk7XHJcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoJ212bCcpO1xyXG4gICAgZWxlbWVudC5pZCA9IGlkO1xyXG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShtZXNzYWdlICsgJ1xcbicpKTtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0YXNrTG9nRGl2JykhLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkhLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKG1lc3NhZ2UgKyAnXFxuJykpO1xyXG4gIH1cclxufSk7XHJcblxyXG5pcGNSZW5kZXJlci5vbignc2VsZWN0RmlsZXNEaXJzLWZpbmlzaGVkJywgKF9ldmVudCwgcGFyYW06IHN0cmluZ1tdKSA9PiB7XHJcbiAgc2VsZWN0ZWREaXJzLmxlbmd0aCA9IDA7XHJcbiAgZm9yIChsZXQgdmFsdWUgb2YgcGFyYW0pIHtcclxuICAgIC8vIEFwcGVuZCBmaWxlbmFtZSB0byB2YXJhaWJsZVxyXG4gICAgc2VsZWN0ZWREaXJzLnB1c2godmFsdWUpO1xyXG4gICAgLy8gQ3JlYXRlIHRoZSBsaXN0IGl0ZW0gYW5kIHNldCBpdHMgY29udGVudHNcclxuICAgIGxldCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICAgIGl0ZW0uYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUodmFsdWUpKTtcclxuICAgIC8vIEFkZCBpdCB0byB0aGUgbGlzdDpcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXJzZmlsZXNMaXN0Jyk/LmFwcGVuZENoaWxkKGl0ZW0pO1xyXG4gIH1cclxufSk7XHJcblxyXG5pcGNSZW5kZXJlci5vbignc2VsZWN0T3V0RGlyZWN0b3J5LWZpbmlzaGVkJywgKF9ldmVudCwgcGFyYW06IHN0cmluZykgPT4ge1xyXG4gIC8vIEFwcGVuZCBmaWxlbmFtZSB0byB2YXJhaWJsZVxyXG4gIGFyZ3Mub3V0RGlyID0gcGFyYW07XHJcbiAgLy8gQ3JlYXRlIHRoZSBsaXN0IGl0ZW0gYW5kIHNldCBpdHMgY29udGVudHNcclxuICBsZXQgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJykuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGFyYW0pKTtcclxuICAvLyBBZGQgaXQgdG8gdGhlIGxpc3Q6XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ291dHB1dERpckxpc3QnKT8uYXBwZW5kQ2hpbGQoaXRlbSk7XHJcbn0pO1xyXG4iXX0=